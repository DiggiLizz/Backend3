-- 1. Tabla de Cuentas (Base)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE ACCOUNTS CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
CREATE TABLE ACCOUNTS (
  ACCOUNT_ID     VARCHAR2(50)   PRIMARY KEY,
  ACCOUNT_TYPE   VARCHAR2(20)   NOT NULL,
  BALANCE        NUMBER(18,2)   NOT NULL,
  ANNUAL_RATE    NUMBER(10,6)   NOT NULL
);

-- 2. Tabla de Transacciones Diarias (Sincronizada con DailyMovementsJobConfig)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE DAILY_TRANSACTIONS CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
CREATE TABLE DAILY_TRANSACTIONS (
  TX_ID           VARCHAR2(100) PRIMARY KEY,
  ACCOUNT_ID      VARCHAR2(50)  NOT NULL,
  TX_TIMESTAMP    TIMESTAMP     NOT NULL,
  AMOUNT          NUMBER(18,2)  NOT NULL,
  CHANNEL         VARCHAR2(50)  NOT NULL,
  ANOMALY         VARCHAR2(10), -- Ampliado para aceptar "YES"/"NO" o "Y"/"N"
  ANOMALY_REASON  VARCHAR2(4000),
  CONSTRAINT FK_TX_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID)
);

-- 3. Tabla de Resultados de Intereses (Sincronizada con QuarterlyInterestJobConfig)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE INTEREST_RESULTS CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
CREATE TABLE INTEREST_RESULTS (
  ID                NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ACCOUNT_ID        VARCHAR2(50)  NOT NULL,
  QUARTER           VARCHAR2(10)  NOT NULL,
  INTEREST_APPLIED  NUMBER(18,2)  NOT NULL,
  NEW_BALANCE       NUMBER(18,2)  NOT NULL,
  CONSTRAINT FK_INT_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID)
);

-- 4. Tabla de Estados Anuales (Sincronizada con AnnualStatementsJobConfig)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE ANNUAL_STATEMENTS CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
CREATE TABLE ANNUAL_STATEMENTS (
  ID              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ACCOUNT_ID      VARCHAR2(50)     NOT NULL,
  YEAR            NUMBER(4)        NOT NULL,
  TOTAL_CREDITS   NUMBER(18,2)     NOT NULL,
  TOTAL_DEBITS    NUMBER(18,2)     NOT NULL,
  ENDING_BALANCE  NUMBER(18,2)     NOT NULL,
  AUDIT_FLAG      VARCHAR2(10),    -- Ampliado para compatibilidad con Java String
  AUDIT_NOTE      VARCHAR2(4000),
  CONSTRAINT FK_ANSTAT_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID)
);

COMMIT;